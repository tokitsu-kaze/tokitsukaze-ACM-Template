# [AGC043D] Merge Triplets

## 题面

给定如下构造生成长度为 $3N$ 的排列 $P$ 的方法：
- 先生成一个长度为 $3N$ 的排列 $A$。然后将 $\forall k \in [0, N-1]$，$A_{3k+1},A_{3k+2},A_{3k+3}$ 分成一块。
- 有 $N$ 个指针，初始指向每个块的第一个数。
- 每次选择所有指针指向的数中最小的数删除，然后放到 $P$ 的末尾。之后指向被删除的数后移一个位置。若移出块了，则删除这个指针。

请你求出，一共能生成长度为 $3N$ 的排列共多少种。答案可能很大，请求出对 $M$ 取模的结果。

$1 \leq N \leq 2 \times 10^3$，$10^8\leq M \leq 10^9+7$。

https://atcoder.jp/contests/agc043/tasks/agc043_d

## 想法

- 2024.07.30
- 毫无想法

## 题解

注意到如果一个序列里有一个下降的段，例如 $3,2,1$。

这个段肯定会在第一个数被选出来之后**立刻**被选完，原因显然。

- 显然：因为下一个选的数要小于上一个选的数，每次又是选最小的，那必定选的是上一个数的后面那个

于是我们可以把下降的段缩成一段，这一段的值为其第一个数的值。

然后考虑如何判定一个序列能不能被构造出来。

显然一个序列只能提供以下三种之一：

* 长度为 $3$ 的下降序列。
* 一个长度为 $2$ 的下降序列和一个长度为 $1$ 的下降序列。
* 三个长度为 $1$ 的下降序列。

因此，长度为 $3n$，仅包含长度为 $1,2,3$ 的下降序列，且长度为 $2$ 的下降序列不多于长度为 $1$ 的下降序列的所有序列都可以被构造出来。

考虑dp，$dp_{i,j}$ 表示选了 $i$ 个数，长度为 $1$ 的下降序列个数减去长度为 $2$ 的下降序列个数为 $j$ 的方案数

转移分3种情况：

- 长度为1的：$dp_{i,j}+=dp_{i-1,j-1}$

  选的一定是前 $i$ 个数的最大值

- 长度为2的：$dp_{i,j}+=dp_{i-2,j+1} \times (i-1)$

  先选前 $i$ 个数的最大值，然后再从剩下的当中随便选一个，所以乘上 $i-1$

- 长度为3的：$dp_{i,j}+=dp_{i-3,j} \times (i-1) \times (i-2)$

  同理，先选最大的，再从剩下的随便选一个，再再从剩下的随便选一个

答案是 $\sum dp_{3*n,j}, j\geq 0$



## 总结

没有发现长度为 $3$ 是很有用的，没有去挖掘性质